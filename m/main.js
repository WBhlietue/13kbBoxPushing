function Tween({from:e=0,to:n=1,duration:t=100,ease:o=(e=>e),onUpdate:l=(()=>{}),onComplete:a=(()=>{})}){function s(n){w&&(null!=n&&(null!=c&&(y+=n-c),c=n),y>=t?(l(o(1)*p+e),a&&a(),w=!1):l&&l(o(y/t)*p+e),requestAnimationFrame(s))}function r(){w=!1}function i(){y=0}function d(){y=0,w=!1,l(e)}const p=n-e;let c;var y=0,w=!0;return requestAnimationFrame(s),{Kill:r,Reload:i,Reset:d}}function ResizeWindow(){let e,n=window.innerWidth-windowBorder,t=window.innerHeight-windowBorder,o=1;e=t/gameWindow.offsetHeight*gameWindow.offsetWidth,o=e<n?e/gameWindow.offsetWidth:n/gameWindow.offsetWidth,centerX=gameWindow.offsetWidth/2,centerY=gameWindow.offsetHeight/2,gameWindow.style.transform="translate(-50%, -50%)scale("+o+")"}function PlayerMove(e,n,t=0,o=!0){if(gameOver)return;let l,a,s=!1;if(boxPos.map(e=>{e[0]==n[0]&&e[1]==n[1]&&(s=!0,l=boxes[boxPos.indexOf(e)],a=e)}),!s&&!o)return(3==currentMap[n[0]][n[1]]||0==currentMap[n[0]][n[1]])&&(ChangePower(-((t-1)*(5+t)+1)),!0);if(!moving){let s=[n[0],n[1]];if("KeyA"==e||"ArrowLeft"==e)n[1]>0&&(SetPlayer("L"),s[1]--);else if("KeyD"==e||"ArrowRight"==e)n[1]<mS-1&&(SetPlayer("R"),s[1]++);else if("KeyW"==e||"ArrowUp"==e)n[0]>0&&(SetPlayer("B"),s[0]--);else{if("KeyS"!=e&&"ArrowDown"!=e)return!1;n[0]<mS-1&&(SetPlayer("F"),s[0]++)}let r=PlayerMove(e,s,t+1,!1);return r&&(moving=!0,MoveDIR(s[1]-n[1],!1,o?player:l,o?playerPos:a),MoveDIR(s[0]-n[0],!0,o?player:l,o?playerPos:a)),o&&Check(),r}return!1}function SetPlayer(e){player.children[0].src="./src/p"+e+".png"}function Restart(){LoadLevel(currentLevel),endWindow.style.display="none",howWindow.style.display="none",fail.style.display="none"}function Create(e){return document.createElement(e)}function Get(e){return document.getElementById(e)}function NextGame(){gameOver&&(-1!=st?(fail.style.display="none",endWindow.style.display="none",currentLevel<7?LoadLevel(currentLevel+1):(game.style.display="none",startWindow.style.display="block",howWindow.style.display="none")):Restart())}function MoveDIR(e,n,t,o){0!=e&&(o=Move(t,e,o,n))}function Move(e,t,o,l){o[l?0:1]+=t;let a=l?e.style.top:e.style.left;return Tween({from:parseFloat(a.substring(0,a.length-2)),to:s*(o[l?0:1]-n)+(l?centerY:centerX),onComplete:()=>{moving=!1},onUpdate:n=>{l?e.style.top=n+"px":e.style.left=n+"px"}}),o}function Check(){if(inGaming){var e=!0;boxPos.map(n=>{3!=currentMap[n[0]][n[1]]&&(e=!1)}),e&&(gameOver=!0,isWin=!0,st=1,endWindow.style.display="block",fail.style.display="none",SetPlayer("F"));for(let e=0;e<potionPos.length;e++)if(console.log(playerPos,e),playerPos[0]==potionPos[e][0]&&playerPos[1]==potionPos[e][1]){power=100,ChangePower(0),potion[e].style.display="none",potion.splice(e,1),potionPos.splice(e,1);break}}}function ChangePower(e){power+=e,console.log(isWin),power<0&&!isWin&&(power=0,st=-1,SetPlayer("D"),gameOver=!0,fail.style.display="block"),powerBar.style.width=power+"%"}function LoadLevel(e){function t(e){const n=Create("div"),t=Create("img");if("h"==e){const e=Create("div");e.className="hole",n.appendChild(e)}return n.style.width=s+"px",n.style.height=s+"px",t.src="src/"+("h"==e?"g":e)+".png",n.className="element",n.appendChild(t),n}function o(){for(let o=0;o<mS;o++)for(let l=0;l<mS;l++){let a="";switch(currentMap[o][l]){case 0:a="g";break;case 1:a="wall";break;case 2:a="g",currentMap[o][l]=0,potionPos.push([o,l]);break;case 3:a="h";break;case 4:a="g",currentMap[o][l]=0,boxPos.push([o,l]);break;case 5:a="g",currentMap[o][l]=0,playerPos=[o,l]}var e=t(a);e.style.left=s*(l-n)+centerX+"px",e.style.top=s*(o-n)+centerY+"px",game.appendChild(e)}player=t("pF"),game.appendChild(player),player.style.left=s*(playerPos[1]-n)+centerX+"px",player.style.top=s*(playerPos[0]-n)+centerY+"px",boxPos.map(e=>{let o=t("box");o.style.left=s*(e[1]-n)+centerX+"px",o.style.top=s*(e[0]-n)+centerY+"px",boxes.push(o),game.appendChild(o)}),potionPos.map(e=>{let o=t("potion");o.style.left=s*(e[1]-n)+centerX+"px",o.style.top=s*(e[0]-n)+centerY+"px",potion.push(o),game.appendChild(o)})}currentMap=[],gameOver=!1,power=100,console.log(power),currentLevel=e;for(let n=0;n<mS;n++){let t=[];for(let o=0;o<mS;o++)t.push(levels[e][n][o]);currentMap.push(t)}playerPos=[0,0],moving=!1,boxPos=[],boxes=[],potion=[],potionPos=[],inGaming=!0,game.innerHTML="";var l=Create("div");l.className="bar";var a=Create("img");a.src="src/restart.png",a.className="restart",a.addEventListener("click",()=>{Restart()}),l.appendChild(a);var r=Create("img");r.src="src/how.png",r.className="restart",r.addEventListener("click",()=>{howWindow.style.display="block"}),l.appendChild(r);var i=Create("img");i.src="src/home.png",i.className="restart",i.addEventListener("click",()=>{game.style.display="none",startWindow.style.display="block",endWindow.style.display="none",howWindow.style.display="none",fail.style.display="none"}),l.appendChild(i),game.appendChild(l);var d=Create("div");d.className="power",powerBar=Create("div"),powerBar.className="powerBar",d.appendChild(powerBar),game.appendChild(d);var p=Create("div");p.className="powerText",p.innerHTML="Power",game.appendChild(p),o()}var isWin=!1,currentLevel=0;const startWindow=Get("Start"),gameWindow=Get("Main"),endWindow=Get("End"),game=Get("Game"),howWindow=Get("How"),listBtn=Get("list"),fail=Get("Fail"),levelWindow=Get("Level");listBtn.addEventListener("click",()=>{howWindow.style.display="none",levelWindow.style.display="block";const e=Get("level");e.innerHTML="";for(let n=0;n<8;n++){let t=Create("div");t.className="level",t.innerHTML="Level "+(n+1),t.addEventListener("click",()=>{levelWindow.style.display="none",startWindow.style.display="none",game.style.display="block",LoadLevel(n)}),e.appendChild(t)}}),Get("X2").addEventListener("click",()=>{levelWindow.style.display="none"}),Get("X").addEventListener("click",()=>{howWindow.style.display="none"}),Get("how").addEventListener("click",()=>{howWindow.style.display="block",levelWindow.style.display="none"}),Get("next").addEventListener("click",()=>{NextGame()}),levelWindow.style.display="none",howWindow.style.display="none",startWindow.style.display="block",game.style.display="none",endWindow.style.display="none",fail.style.display="none";const startBtn=Get("StartBtn");startBtn.addEventListener("click",()=>{startWindow.style.display="none",game.style.display="block",endWindow.style.display="none",LoadLevel(0)});var inGaming=!1;const windowBorder=50;var centerX,centerY,player,currentMap,levels=[[[1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,3,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,4,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,5,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,1,3,0,0,0,0,1],[1,0,0,0,0,1,1,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,5,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,4,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,4,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,3,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,5,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,3,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,0,1,1,1,1,1,1],[1,0,2,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,4,0,0,3,0,0,1],[1,1,1,1,1,4,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,5,0,1],[1,1,1,1,1,1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,1,0,0,0,1,0,3,1],[1,0,0,0,1,0,0,0,1,0,0,1],[1,0,0,0,1,0,0,0,1,0,3,1],[1,0,0,0,1,0,0,0,1,0,0,1],[1,5,0,0,4,0,4,0,4,0,3,1],[1,0,0,0,1,0,0,0,1,0,0,1],[1,0,0,0,1,0,0,0,1,0,0,1],[1,0,0,0,1,0,0,0,1,0,0,1],[1,0,0,0,1,0,0,0,1,0,0,1],[1,0,0,0,1,0,0,0,1,0,2,1],[1,1,1,1,1,1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1,1,1,1,1,1],[1,3,0,0,0,2,0,0,0,0,3,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,4,4,0,0,0,2,1],[1,0,0,0,0,4,4,0,0,0,0,1],[1,5,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,3,0,0,0,0,2,0,0,0,3,1],[1,1,1,1,1,1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1,1,1,1,1,1],[1,0,3,0,0,0,0,0,0,3,0,1],[1,3,0,0,0,0,0,0,0,0,3,1],[1,0,0,0,0,4,4,0,0,0,0,1],[1,0,0,0,0,4,4,2,0,0,0,1],[1,0,0,2,1,1,1,1,2,0,0,1],[1,5,0,2,1,1,1,1,2,0,0,1],[1,0,0,0,2,4,4,0,0,0,0,1],[1,0,0,0,0,4,4,0,0,0,0,1],[1,3,0,0,0,0,0,0,0,0,3,1],[1,0,3,0,0,0,0,0,0,3,0,1],[1,1,1,1,1,1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,2,0,3,3,3,3,0,2,1,1],[1,2,2,0,1,1,1,1,0,2,2,1],[1,0,0,4,0,0,0,0,4,0,0,1],[1,3,1,0,4,4,4,4,0,1,3,1],[1,3,1,0,4,5,0,4,0,1,3,1],[1,3,1,0,4,0,0,4,0,1,3,1],[1,3,1,0,4,4,4,4,0,1,3,1],[1,0,0,4,0,0,0,0,4,0,0,1],[1,2,2,0,1,1,1,1,0,2,2,1],[1,1,2,0,3,3,3,3,0,2,1,1],[1,1,1,1,1,1,1,1,1,1,1,1]]];document.addEventListener("keydown",e=>{inGaming&&("KeyR"==e.code&&Restart(),"Space"==e.code&&NextGame(),PlayerMove(e.code,playerPos))}),window.addEventListener("resize",ResizeWindow);var playerPos,moving,boxPos,boxes,powerBar,potionPos,potion,mS=12,n=mS/2-.5,s=80,gameOver=!1,power=100,st=0;ResizeWindow();